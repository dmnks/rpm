#!/bin/bash
#
# Podman-based mktree backend using an OCI image to build and run RPM.
# Works standalone (outside of a build directory) too.

if [ "$(basename $0)" == "mktree" ]; then
    # Running from build directory
    CONTEXT=@CMAKE_SOURCE_DIR@
else
    # Running from source directory
    CONTEXT=..
fi

IMAGE=rpm
CMD=$1; shift

case $CMD in
    build)
        podman image exists $IMAGE && podman rmi $IMAGE
        podman build --tag $IMAGE -f Dockerfile $CONTEXT
    ;;
    check)
        ./mktree.native check --log "$@"
    ;;
    *)
        echo "Unsupported command." >&2
        exit 1
    ;;
esac
