#!/bin/bash

case $1 in
    base)
        @UNSHARE_CMD@ rm -rf @TREE_DIR@
        ./mktree.@OS_NAME@
    ;;
    inst)
        rm -rf @INST_DIR@
        @CMAKE_MAKE_PROGRAM@ -C @CMAKE_BINARY_DIR@ \
            DESTDIR=@CMAKE_CURRENT_BINARY_DIR@/@INST_DIR@ install
        mkdir -p @PROFILE_DIR@ @LD_CONF_DIR@
        echo "export PATH=@CMAKE_INSTALL_FULL_BINDIR@:/usr/bin" > \
            @PROFILE_DIR@/rpm.sh
        echo @CMAKE_INSTALL_FULL_LIBDIR@ > @LD_CONF_DIR@/rpm.conf
        ldconfig -r @INST_DIR@ @CMAKE_INSTALL_FULL_LIBDIR@
    ;;
    util)
        rm -rf @UTIL_DIR@
        mkdir -p @UTIL_DIR@/data
        cp -r @CMAKE_CURRENT_SOURCE_DIR@/data @UTIL_DIR@/
        mkdir -p @UTIL_DIR@/usr/bin
        cp @TESTPROGS_NAMES@ @UTIL_DIR@/usr/bin/
        mkdir -p @UTIL_DIR@/build
        ln -sf /data/SOURCES @UTIL_DIR@/build/
    ;;
esac
